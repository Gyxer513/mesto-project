(()=>{"use strict";function e(e){return function(e){if(Array.isArray(e))return t(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var o=Object.prototype.toString.call(e).slice(8,-1);return"Object"===o&&e.constructor&&(o=e.constructor.name),"Map"===o||"Set"===o?Array.from(e):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?t(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function n(e){return function(e){if(Array.isArray(e))return o(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?o(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var r=document.querySelector(".popup__button-save_inactive");function a(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&C(t)}}function c(e){n(e.querySelectorAll(".popup__error-text")).forEach((function(e){e.classList.remove("popup__error-text_visible")})),n(e.querySelectorAll(".popup__form-input")).forEach((function(e){e.classList.remove("popup__form-input_error")})),function(e){var t=e.querySelector(".popup__button-save");t.classList.add("popup__button-save_inactive"),t.disabled="disabled"}(e)}function i(e){r.textContent=e?"Сохранение...":"Сохранить"}function u(e){r.textContent=e?"Удаление...":"Удалить"}document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&C(e),t.target.classList.contains("popup__container-button")&&C(e)}))}));var l=document.querySelector(".popup_js-edit-profile"),s=document.querySelector(".popup_js-add-place"),d=document.querySelector(".zoom"),p=document.querySelector(".popup_js-remove"),f=document.querySelector(".popup_js-avatar"),m=document.querySelector(".profile__button-name"),v=document.querySelector(".profile__button-place"),y=document.querySelector("#name"),_=document.querySelector("#subname"),h=document.querySelector("#avatarPicture"),b=document.querySelector(".profile__name"),S=document.querySelector(".profile__subname"),q=l.querySelector(".popup__form"),g=s.querySelector(".popup__form"),E=s.querySelector(".popup__container-button");function L(e){e.classList.add("popup_opened"),document.addEventListener("keydown",a)}function C(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",a)}l.querySelector(".popup__container-button"),m.addEventListener("click",(function(){L(l),y.value=b.textContent,_.value=S.textContent,c(l)})),v.addEventListener("click",(function(){L(s),c(s)}));var A={headers:{authorization:"f8513dfa-6b67-48df-91bb-0f182fdad87d"}},k=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var x=document.querySelector("#place"),w=document.querySelector("#picture"),O=(document.querySelector("#avatarPicture"),document.querySelector(".zoom__image")),T=document.querySelector(".zoom__signature"),z=document.querySelector("#element");function I(e){var t=z.content.querySelector(".element__place").cloneNode(!0),n=t.querySelector(".element__image");n.src=e.link,n.alt=e.name,t.querySelector(".element__name").textContent=e.name;var o=t.querySelector(".element__button-remove"),r=e._id;"05d3d3f5b84fd3710ec0b673"===e.owner._id?o.addEventListener("click",(function(){L(p),p.addEventListener("submit",(function(e){var n;e.preventDefault(),(n=r,fetch("https://nomoreparties.co/v1/plus-cohort-13/cards/".concat(n),{method:"DELETE",headers:{authorization:"f8513dfa-6b67-48df-91bb-0f182fdad87d"},body:JSON.stringify(n)}).then(k)).then((function(){C(p),t.remove()})).finally((function(){u(!1)})),u(!0)}))})):o.classList.add("element__button-remove_invisible");var a,c=t.querySelector(".element__heart"),i=t.querySelector(".element__like-count");return e.likes.forEach((function(e){"05d3d3f5b84fd3710ec0b673"===e._id&&c.classList.add("element__heart_active")})),c.addEventListener("click",(function(e){var t;e.target.classList.contains("element__heart_active")?(t=r,fetch("https://nomoreparties.co/v1/plus-cohort-13/cards/likes/".concat(t),{method:"DELETE",headers:{authorization:"f8513dfa-6b67-48df-91bb-0f182fdad87d"},body:JSON.stringify(t)}).then(k)).then((function(){e.target.classList.remove("element__heart_active"),i.textContent--})):function(e){return fetch("https://nomoreparties.co/v1/plus-cohort-13/cards/likes/".concat(e),{method:"PUT",headers:{authorization:"f8513dfa-6b67-48df-91bb-0f182fdad87d"},body:JSON.stringify(e)}).then(k)}(r).then((function(){e.target.classList.add("element__heart_active"),i.textContent++}))})),i.textContent=(a=e.likes,function(e){if(Array.isArray(e))return j(e)}(a)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(a)||function(e,t){if(e){if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?j(e,t):void 0}}(a)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).length,n.addEventListener("click",(function(){O.src=e.link,O.alt=e.link,T.textContent=e.name,L(d)})),t}d.querySelector(".popup__container-button");var N,P=document.querySelector("#elements"),D=document.querySelector("#avatar"),J=document.querySelector(".profile__photo"),B=document.querySelector(".popup_js-avatar");function M(){fetch("https://nomoreparties.co/v1/plus-cohort-13/users/me",A).then(k).catch((function(e){console.log(e)})).then((function(e){var t;t=e,b.textContent=t.name,S.textContent=t.about,D.src=t.avatar,D.alt=t.name}))}E.addEventListener("click",(function(){C(s)})),N={formSelector:".popup__form",inputSelector:".popup__form-input",submitButtonSelector:".popup__button-save",inactiveButtonClass:"popup__button-save_inactive",inputErrorClass:"popup__form-input_error",errorClass:"popup__error-text_visible"},e(document.querySelectorAll(N.formSelector)).forEach((function(t){!function(t,n){var o=t.querySelectorAll(n.inputSelector),r=t.querySelector(n.submitButtonSelector);e(o).forEach((function(e){e.addEventListener("input",(function(o){!function(e,t,n){var o=t.querySelector(".".concat(e.id,"-error"));!e.validity.valid||(e.textContent="")?function(e,t,n){e.classList.add(n.errorClass),t.classList.add(n.inputErrorClass),e.textContent=t.validationMessage}(o,e,n):function(e,t,n){e.classList.remove(n.errorClass),t.classList.remove(n.inputErrorClass)}(o,e,n)}(e,t,n),function(e){var t=arguments.length>2?arguments[2]:void 0;arguments.length>1&&void 0!==arguments[1]&&arguments[1]?(e.classList.remove(t.inactiveButtonClass),e.disabled=!1):(e.classList.add(t.inactiveButtonClass),e.disabled="disabled")}(r,t.checkValidity(),n)}))}))}(t,N)})),fetch("https://nomoreparties.co/v1/plus-cohort-13/cards",A).then(k).then((function(e){e.forEach((function(e){P.prepend(I(e))}))})),M(),g.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={name:x.value,link:w.value},fetch("https://nomoreparties.co/v1/plus-cohort-13/cards",{method:"POST",headers:{authorization:"f8513dfa-6b67-48df-91bb-0f182fdad87d","Content-Type":"application/json"},body:JSON.stringify(t)}).then(k)).then((function(e){P.append(I(e)),C(s),g.reset()})).finally((function(){i(!1)})),i(!0)})),q.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={name:y.value,about:_.value},fetch("https://nomoreparties.co/v1/plus-cohort-13/users/me",{method:"PATCH",headers:{authorization:"f8513dfa-6b67-48df-91bb-0f182fdad87d","Content-Type":"application/json"},body:JSON.stringify(t)}).then(k)).then((function(e){b.textContent=y.value,S.textContent=_.value,C(l),C(s),g.reset()})).finally((function(){i(!1)})),i(!0)})),J.addEventListener("click",(function(){L(f)})),B.addEventListener("submit",(function(e){var t;e.preventDefault(),(t={avatar:h.value},fetch("https://nomoreparties.co/v1/plus-cohort-13/users/me/avatar",{method:"PATCH",headers:{authorization:"f8513dfa-6b67-48df-91bb-0f182fdad87d","Content-Type":"application/json"},body:JSON.stringify(t)}).then(k)).then((function(e){console.log(e),M(),C(f)}))}))})();